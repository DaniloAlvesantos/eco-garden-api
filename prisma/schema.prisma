generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(cuid())
  name         String
  email        String   @unique
  password     String
  passwordSalt String
  phone        String   @unique
  Garden       Garden[] @relation("UserGardens")
}

model Garden {
  id                String              @id @default(cuid())
  name              String
  owner             User                @relation("UserGardens", fields: [userId], references: [id])
  userId            String
  lat               Float
  lng               Float
  img_url           String
  cep               String
  number            Int
  createdAt         DateTime            @default(now())
  tamanho_m2        Int
  irrigationHistory IrrigationHistory[]
  plants            PlantGarden[]

  @@unique([lat, lng]) // Um jardim não pode existir na mesma coordenada que outro
  @@unique([cep, number]) // Um jardim não pode existir no mesmo endereço físico (CEP + número)
  @@index([userId])
}

model Plant {
  id              Int           @id @default(autoincrement())
  nome_comum      String
  nome_cientifico String        @unique
  umidade_min     Int
  umidade_max     Int
  temp_min        Int
  temp_max        Int
  gardens         PlantGarden[]
}

model PlantGarden {
  id           String   @id @default(cuid())
  plantId      Int
  gardenId     String
  quant        Int
  data_plantio DateTime
  plant        Plant    @relation(fields: [plantId], references: [id])
  garden       Garden   @relation(fields: [gardenId], references: [id])

  @@index([plantId, gardenId])
}

model Irrigation {
  id                  String             @id @default(cuid())
  start_time          DateTime
  end_time            DateTime
  volume              Float
  status              String
  gardenId            String
  history             IrrigationHistory? @relation(fields: [irrigationHistoryId], references: [id])
  irrigationHistoryId String?

  @@index([irrigationHistoryId])
}

model IrrigationHistory {
  id          String       @id @default(cuid())
  gardenId    String
  temperature Int
  humidity    Int
  timestamp   DateTime
  garden      Garden       @relation(fields: [gardenId], references: [id])
  irrigations Irrigation[]

  @@index([gardenId])
}
